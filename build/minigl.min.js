function Vec3(){var a,b,c,d,e,f,g=this;return this.set=function(a,b,c){return g.x=a,g.y=b,g.z=c,g},this.copy=function(a){return g.x=a.x,g.y=a.y,g.z=a.z,g},this.length=function(){return Math.sqrt(g.x*g.x+g.y*g.y+g.z*g.z)},this.multiplyScalar=function(a){return g.x*=a,g.y*=a,g.z*=a,g},this.sub=function(a){return g.x-=a.x,g.y-=a.y,g.z-=a.z,g},this.add=function(a){return g.x+=a.x,g.y+=a.y,g.z+=a.z,g},this.negate=function(){return g.x=-g.x,g.y=-g.y,g.z=-g.z,g},this.normalize=function(){return g.multiplyScalar(1/g.length()),g},this.cross=function(h){return a=g.x,b=g.y,c=g.z,d=h.x,e=h.y,f=h.z,g.x=b*f-c*e,g.y=c*d-a*f,g.z=a*e-b*d,g},this.dot=function(a){return g.x*=a.x,g.y*=a.y,g.z*=a.z,g},3===arguments.length?(g.x=arguments[0],g.y=arguments[1],g.z=arguments[2]):1===arguments.length?arguments[0].hasOwnProperty("el")?(g.x=arguments[0].el[12],g.y=arguments[0].el[13],g.z=arguments[0].el[14]):g.copy(arguments[0]):g.x=g.y=g.z=0,this}function Mat4(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P=this;return this.reset=function(){P.el=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]},this.setPosition=function(){return 3===arguments.length?(P.el[12]=x,P.el[13]=y,P.el[14]=z):1===arguments.length&&(P.el[12]=arguments[0].x,P.el[13]=arguments[0].y,P.el[14]=arguments[0].z),P},this.multiply=function(x){return q=P.el[0],a=x[0],r=P.el[1],b=x[1],s=P.el[2],c=x[2],t=P.el[3],d=x[3],u=P.el[4],e=x[4],v=P.el[5],f=x[5],w=P.el[6],g=x[6],A=P.el[7],h=x[7],B=P.el[8],i=x[8],C=P.el[9],j=x[9],D=P.el[10],k=x[10],E=P.el[11],l=x[11],F=P.el[12],m=x[12],G=P.el[13],n=x[13],H=P.el[14],o=x[14],I=P.el[15],p=x[15],P.el=[q*a+r*e+s*i+t*m,q*b+r*f+s*j+t*n,q*c+r*g+s*k+t*o,q*d+r*h+s*l+t*p,u*a+v*e+w*i+A*m,u*b+v*f+w*j+A*n,u*c+v*g+w*k+A*o,u*d+v*h+w*l+A*p,B*a+C*e+D*i+E*m,B*b+C*f+D*j+E*n,B*c+C*g+D*k+E*o,B*d+C*h+D*l+E*p,F*a+G*e+H*i+I*m,F*b+G*f+H*j+I*n,F*c+G*g+H*k+I*o,F*d+G*h+H*l+I*p],P},this.rotateX=function(a){return J=Math.cos(a),K=Math.sin(a),r=P.el[1],v=P.el[5],C=P.el[9],G=P.el[13],P.el[1]=P.el[1]*J-P.el[2]*K,P.el[2]=r*K+P.el[2]*J,P.el[5]=P.el[5]*J-P.el[6]*K,P.el[6]=v*K+P.el[6]*J,P.el[9]=P.el[9]*J-P.el[10]*K,P.el[10]=C*K+P.el[10]*J,P.el[13]=P.el[13]*J-P.el[14]*K,P.el[14]=G*K+P.el[14]*J,P},this.rotateY=function(a){return J=Math.cos(a),K=Math.sin(a),q=P.el[0],u=P.el[4],B=P.el[8],F=P.el[12],P.el[0]=P.el[2]*K+P.el[0]*J,P.el[2]=P.el[2]*J-q*K,P.el[4]=P.el[6]*K+P.el[4]*J,P.el[6]=P.el[6]*J-u*K,P.el[8]=P.el[10]*K+P.el[8]*J,P.el[10]=P.el[10]*J-B*K,P.el[12]=P.el[14]*K+P.el[12]*J,P.el[14]=P.el[14]*J-F*K,P},this.rotateZ=function(a){return J=Math.cos(a),K=Math.sin(a),q=P.el[0],u=P.el[4],B=P.el[8],F=P.el[12],P.el[0]=P.el[0]*J-P.el[1]*K,P.el[1]=q*K+P.el[1]*J,P.el[4]=P.el[4]*J-P.el[5]*K,P.el[5]=u*K+P.el[5]*J,P.el[8]=P.el[8]*J-P.el[9]*K,P.el[9]=B*K+P.el[9]*J,P.el[12]=P.el[12]*J-P.el[13]*K,P.el[13]=F*K+P.el[13]*J,P},this.setScale=function(a,b,c){return P.el[0]*=a,P.el[1]*=b,P.el[2]*=c,P.el[4]*=a,P.el[5]*=b,P.el[6]*=c,P.el[8]*=a,P.el[9]*=b,P.el[10]*=c,P.el[12]*=a,P.el[13]*=b,P.el[14]*=c,P},this.copy=function(a){for(var b=0;b<16;b++)P.el[b]=a.el[b];return P},this.multiplyScalar=function(a){for(var b=0;b<16;b++)P.el[b]*=a;return P},this.inverse=function(){var a=P.el[0],b=P.el[1],c=P.el[2],d=P.el[3],e=P.el[4],f=P.el[5],g=P.el[6],h=P.el[7],i=P.el[8],j=P.el[9],k=P.el[10],l=P.el[11],m=P.el[12],n=P.el[13],o=P.el[14],p=P.el[15],q=j*o*h-n*k*h+n*g*l-f*o*l-j*g*p+f*k*p,r=m*k*h-i*o*h-m*g*l+e*o*l+i*g*p-e*k*p,s=i*n*h-m*j*h+m*f*l-e*n*l-i*f*p+e*j*p,t=m*j*g-i*n*g-m*f*k+e*n*k+i*f*o-e*j*o,u=a*q+b*r+c*s+d*t;return 0!==u?(P.el[0]=q,P.el[1]=n*k*d-j*o*d-n*c*l+b*o*l+j*c*p-b*k*p,P.el[2]=f*o*d-n*g*d+n*c*h-b*o*h-f*c*p+b*g*p,P.el[3]=j*g*d-f*k*d-j*c*h+b*k*h+f*c*l-b*g*l,P.el[4]=r,P.el[5]=i*o*d-m*k*d+m*c*l-a*o*l-i*c*p+a*k*p,P.el[6]=m*g*d-e*o*d-m*c*h+a*o*h+e*c*p-a*g*p,P.el[7]=e*k*d-i*g*d+i*c*h-a*k*h-e*c*l+a*g*l,P.el[8]=s,P.el[9]=m*j*d-i*n*d-m*b*l+a*n*l+i*b*p-a*j*p,P.el[10]=e*n*d-m*f*d+m*b*h-a*n*h-e*b*p+a*f*p,P.el[11]=i*f*d-e*j*d-i*b*h+a*j*h+e*b*l-a*f*l,P.el[12]=t,P.el[13]=i*n*c-m*j*c+m*b*k-a*n*k-i*b*o+a*j*o,P.el[14]=m*f*c-e*n*c-m*b*g+a*n*g+e*b*o-a*f*o,P.el[15]=e*j*c-i*f*c+i*b*g-a*j*g-e*b*k+a*f*k,P.multiplyScalar(1/u)):console.warn("Mat4 : Cannot inverse matrix, determinant is null"),P},this.perspective=function(a,b,c,d){return L=Math.tan(Math.PI*a/360),P.el[0]=.5/L,P.el[5]=.5*b/L,P.el[10]=-(d+c)/(d-c),P.el[11]=-1,P.el[14]=-2*d*c/(d-c),P.el[15]=0,P},this.lookAt=function(){return"undefined"==typeof M&&(M={x:new Vec3,y:new Vec3,z:new Vec3}),3===arguments.length?N={x:arguments[0],y:arguments[1],z:arguments[2]}:1===arguments.length&&(N=arguments[0]),M.z.set(P.el[12],P.el[13],P.el[14]).sub(N).normalize(),0===M.z.length()&&(M.z.z=1),M.x.set(0,1,0).cross(M.z).normalize(),0===M.x.length()&&(M.z.x+=1e-4,M.x.cross(M.z).normalize()),M.y.copy(M.z).cross(M.x),P.el[0]=M.x.x,P.el[4]=M.y.x,P.el[8]=M.z.x,P.el[1]=M.x.y,P.el[5]=M.y.y,P.el[9]=M.z.y,P.el[2]=M.x.z,P.el[6]=M.y.z,P.el[10]=M.z.z,P},this.transpose=function(){return O=P.el,P.el[1]=O[4],P.el[2]=O[8],P.el[3]=O[12],P.el[4]=O[1],P.el[6]=O[9],P.el[7]=O[13],P.el[8]=O[2],P.el[9]=O[6],P.el[11]=O[14],P.el[12]=O[3],P.el[13]=O[7],P.el[14]=O[11],O=void 0,P},0===arguments.length?P.reset():1===arguments.length&&P.copy(arguments[0]),this}